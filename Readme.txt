This is the core implementation of RFDet. 
